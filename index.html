<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ISL Connect â€” 3D Avatar</title>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700;800;900&display=swap" rel="stylesheet" />

  <!-- Three.js import map -->
  <script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
      "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
    }
  }
  </script>

  <style>
    /* â”€â”€ ISL Connect Design Tokens â”€â”€ */
    :root {
      --primary:        #6C3FF6;
      --primary-dark:   #4A1ED4;
      --primary-light:  #9B72F5;
      --accent:         #00C9B1;
      --accent-light:   #4DDDC9;
      --warm:           #FF6B6B;
      --bg:             #0D0820;      /* deep space â€” dark mode for 3D */
      --bg-card:        #160D2E;
      --bg-surface:     #1E1040;
      --border:         rgba(108,63,246,0.22);
      --border-light:   rgba(255,255,255,0.06);
      --text:           #EDE7FF;
      --text-muted:     rgba(237,231,255,0.5);
      --shadow-primary: rgba(108,63,246,0.35);
      --shadow-accent:  rgba(0,201,177,0.25);
      --glow-primary:   rgba(108,63,246,0.18);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Nunito', sans-serif;
      background: var(--bg);
      color: var(--text);
      height: 100vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TOP HEADER BAR
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .header {
      position: relative;
      z-index: 20;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 20px 12px;
      background: rgba(13,8,32,0.85);
      backdrop-filter: blur(16px);
      border-bottom: 1px solid var(--border);
      flex-shrink: 0;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .back-btn {
      width: 38px; height: 38px;
      background: rgba(108,63,246,0.12);
      border: 1px solid var(--border);
      border-radius: 11px;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
      color: var(--text);
      text-decoration: none;
    }
    .back-btn:hover {
      background: rgba(108,63,246,0.25);
      border-color: var(--primary-light);
    }
    .back-btn svg { width: 18px; height: 18px; }

    .header-title-group { display: flex; flex-direction: column; }

    .header-label {
      font-size: 10px;
      font-weight: 700;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: var(--accent);
      line-height: 1;
      margin-bottom: 2px;
    }

    .header-title {
      font-size: 17px;
      font-weight: 900;
      color: var(--text);
      letter-spacing: -0.3px;
    }

    /* Avatar status pill */
    .status-pill {
      display: flex;
      align-items: center;
      gap: 7px;
      background: rgba(0,201,177,0.1);
      border: 1px solid rgba(0,201,177,0.2);
      border-radius: 20px;
      padding: 6px 14px;
      font-size: 12px;
      font-weight: 700;
      color: var(--accent);
    }
    .status-dot {
      width: 7px; height: 7px;
      background: var(--accent);
      border-radius: 50%;
      animation: statusPulse 2s ease-in-out infinite;
    }
    @keyframes statusPulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50%       { opacity: 0.4; transform: scale(0.75); }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MAIN LAYOUT: canvas + right panel
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .main-layout {
      display: flex;
      flex: 1;
      overflow: hidden;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       3D CANVAS AREA
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .canvas-wrap {
      flex: 1;
      position: relative;
      overflow: hidden;
    }

    #three-canvas {
      display: block;
      width: 100% !important;
      height: 100% !important;
    }

    /* Gradient vignette over canvas bottom */
    .canvas-wrap::after {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(
        ellipse 80% 60% at 50% 110%,
        rgba(108,63,246,0.12) 0%,
        transparent 70%
      );
      pointer-events: none;
    }

    /* â”€â”€ Grid lines background (subtle) â”€â”€ */
    .canvas-wrap::before {
      content: '';
      position: absolute;
      inset: 0;
      background-image:
        linear-gradient(rgba(108,63,246,0.04) 1px, transparent 1px),
        linear-gradient(90deg, rgba(108,63,246,0.04) 1px, transparent 1px);
      background-size: 48px 48px;
      pointer-events: none;
      z-index: 0;
    }

    /* â”€â”€ Loading overlay â”€â”€ */
    .loading-overlay {
      position: absolute;
      inset: 0;
      z-index: 10;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: var(--bg);
      transition: opacity 0.5s ease;
    }
    .loading-overlay.hidden {
      opacity: 0;
      pointer-events: none;
    }

    .loader-ring {
      width: 72px; height: 72px;
      position: relative;
      margin-bottom: 20px;
    }
    .loader-ring::before,
    .loader-ring::after {
      content: '';
      position: absolute;
      border-radius: 50%;
      border: 3px solid transparent;
    }
    .loader-ring::before {
      inset: 0;
      border-top-color: var(--primary);
      animation: spin 1s linear infinite;
    }
    .loader-ring::after {
      inset: 8px;
      border-top-color: var(--accent);
      animation: spin 0.7s linear infinite reverse;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    .loader-icon {
      position: absolute;
      inset: 0;
      display: flex; align-items: center; justify-content: center;
      font-size: 22px;
    }
    .loader-text {
      font-size: 14px;
      font-weight: 700;
      color: var(--text-muted);
      letter-spacing: 0.5px;
    }

    /* â”€â”€ Active sign label overlay â”€â”€ */
    .sign-label-overlay {
      position: absolute;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 8;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      pointer-events: none;
      transition: opacity 0.35s ease;
      opacity: 0;
    }
    .sign-label-overlay.visible { opacity: 1; }

    .sign-name-chip {
      background: linear-gradient(135deg, var(--primary), var(--accent));
      border-radius: 30px;
      padding: 10px 28px;
      font-size: 20px;
      font-weight: 900;
      color: white;
      letter-spacing: 1px;
      box-shadow: 0 8px 32px var(--shadow-primary);
    }
    .sign-sub-chip {
      background: rgba(13,8,32,0.75);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 5px 16px;
      font-size: 11px;
      font-weight: 600;
      color: var(--text-muted);
      letter-spacing: 1px;
      backdrop-filter: blur(8px);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       RIGHT PANEL â€” SIGN BUTTONS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .side-panel {
      width: 220px;
      background: var(--bg-card);
      border-left: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      flex-shrink: 0;
    }

    .panel-header {
      padding: 18px 16px 12px;
      border-bottom: 1px solid var(--border-light);
    }
    .panel-header-label {
      font-size: 10px;
      font-weight: 700;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: var(--text-muted);
      margin-bottom: 4px;
    }
    .panel-header-title {
      font-size: 15px;
      font-weight: 800;
      color: var(--text);
    }

    /* Category tabs */
    .category-tabs {
      display: flex;
      padding: 10px 12px 0;
      gap: 6px;
      flex-shrink: 0;
    }
    .cat-tab {
      flex: 1;
      padding: 7px 4px;
      border-radius: 10px;
      background: transparent;
      border: 1px solid transparent;
      color: var(--text-muted);
      font-family: 'Nunito', sans-serif;
      font-size: 11px;
      font-weight: 700;
      cursor: pointer;
      text-align: center;
      transition: all 0.2s;
      letter-spacing: 0.3px;
    }
    .cat-tab.active {
      background: rgba(108,63,246,0.15);
      border-color: rgba(108,63,246,0.3);
      color: var(--primary-light);
    }
    .cat-tab:hover:not(.active) {
      background: rgba(255,255,255,0.04);
      border-color: var(--border-light);
      color: var(--text);
    }

    /* Scrollable sign list */
    .sign-list {
      flex: 1;
      overflow-y: auto;
      padding: 10px 12px 16px;
      display: flex;
      flex-direction: column;
      gap: 7px;
    }
    .sign-list::-webkit-scrollbar { width: 3px; }
    .sign-list::-webkit-scrollbar-track { background: transparent; }
    .sign-list::-webkit-scrollbar-thumb {
      background: rgba(108,63,246,0.3);
      border-radius: 2px;
    }

    /* Individual sign button */
    .sign-btn {
      width: 100%;
      background: var(--bg-surface);
      border: 1px solid var(--border-light);
      border-radius: 14px;
      padding: 11px 14px;
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
      text-align: left;
      color: var(--text);
      font-family: 'Nunito', sans-serif;
      position: relative;
      overflow: hidden;
    }
    .sign-btn::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      opacity: 0;
      transition: opacity 0.2s;
    }
    .sign-btn:hover { transform: scale(1.02); border-color: rgba(108,63,246,0.4); }
    .sign-btn:hover::before { opacity: 0.07; }
    .sign-btn:active { transform: scale(0.97); }
    .sign-btn.playing {
      border-color: var(--accent);
      background: rgba(0,201,177,0.08);
      box-shadow: 0 0 0 1px rgba(0,201,177,0.2), 0 6px 20px var(--shadow-accent);
    }
    .sign-btn.playing::before { opacity: 0.05; }

    .sign-btn-icon {
      width: 34px; height: 34px;
      border-radius: 10px;
      display: flex; align-items: center; justify-content: center;
      font-size: 17px;
      flex-shrink: 0;
      position: relative; z-index: 1;
    }
    .sign-btn-text {
      position: relative; z-index: 1;
      display: flex; flex-direction: column;
    }
    .sign-btn-name {
      font-size: 13px;
      font-weight: 800;
      color: var(--text);
      line-height: 1.2;
    }
    .sign-btn-sub {
      font-size: 10px;
      font-weight: 500;
      color: var(--text-muted);
      margin-top: 1px;
    }
    .sign-btn-play {
      margin-left: auto;
      position: relative; z-index: 1;
      opacity: 0;
      transition: opacity 0.2s;
    }
    .sign-btn:hover .sign-btn-play,
    .sign-btn.playing .sign-btn-play { opacity: 1; }
    .sign-btn-play svg { width: 16px; height: 16px; }

    /* Playing indicator bars */
    .play-bars {
      display: flex;
      align-items: flex-end;
      gap: 2px;
      height: 16px;
    }
    .play-bar {
      width: 3px;
      background: var(--accent);
      border-radius: 2px;
      animation: barBounce 0.8s ease-in-out infinite;
    }
    .play-bar:nth-child(2) { animation-delay: 0.15s; }
    .play-bar:nth-child(3) { animation-delay: 0.3s; }
    @keyframes barBounce {
      0%, 100% { height: 4px; }
      50%       { height: 14px; }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BOTTOM CONTROLS BAR
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .bottom-bar {
      position: relative;
      z-index: 20;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 20px;
      background: rgba(13,8,32,0.9);
      backdrop-filter: blur(16px);
      border-top: 1px solid var(--border);
      flex-shrink: 0;
      gap: 12px;
    }

    /* Camera controls */
    .camera-controls {
      display: flex;
      gap: 8px;
    }
    .ctrl-btn {
      width: 40px; height: 40px;
      background: rgba(108,63,246,0.1);
      border: 1px solid var(--border);
      border-radius: 12px;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
      color: var(--text-muted);
    }
    .ctrl-btn:hover {
      background: rgba(108,63,246,0.2);
      border-color: var(--primary-light);
      color: var(--text);
    }
    .ctrl-btn svg { width: 18px; height: 18px; }

    /* Speed selector */
    .speed-group {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .speed-label {
      font-size: 11px;
      font-weight: 700;
      color: var(--text-muted);
      letter-spacing: 1px;
      text-transform: uppercase;
    }
    .speed-pills { display: flex; gap: 5px; }
    .speed-pill {
      padding: 5px 12px;
      border-radius: 10px;
      background: transparent;
      border: 1px solid var(--border-light);
      color: var(--text-muted);
      font-family: 'Nunito', sans-serif;
      font-size: 12px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
    }
    .speed-pill.active {
      background: rgba(108,63,246,0.2);
      border-color: var(--primary);
      color: var(--primary-light);
    }
    .speed-pill:hover:not(.active) {
      background: rgba(255,255,255,0.05);
      border-color: var(--border);
      color: var(--text);
    }

    /* Loop toggle */
    .loop-toggle {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      font-weight: 700;
      color: var(--text-muted);
      cursor: pointer;
      user-select: none;
    }
    .loop-toggle input { display: none; }
    .toggle-track {
      width: 36px; height: 20px;
      background: rgba(255,255,255,0.08);
      border-radius: 10px;
      border: 1px solid var(--border-light);
      position: relative;
      transition: all 0.25s;
    }
    .toggle-thumb {
      position: absolute;
      top: 2px; left: 2px;
      width: 14px; height: 14px;
      background: var(--text-muted);
      border-radius: 50%;
      transition: all 0.25s cubic-bezier(0.34,1.56,0.64,1);
    }
    input:checked ~ .toggle-track {
      background: rgba(0,201,177,0.2);
      border-color: var(--accent);
    }
    input:checked ~ .toggle-track .toggle-thumb {
      left: 18px;
      background: var(--accent);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TOAST NOTIFICATION
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .toast {
      position: fixed;
      top: 80px;
      left: 50%;
      transform: translateX(-50%) translateY(-8px);
      background: linear-gradient(135deg, var(--primary-dark), var(--primary));
      border: 1px solid rgba(155,114,245,0.3);
      border-radius: 22px;
      padding: 10px 22px;
      font-size: 13px;
      font-weight: 700;
      color: white;
      box-shadow: 0 12px 40px var(--shadow-primary);
      z-index: 100;
      opacity: 0;
      transition: all 0.35s cubic-bezier(0.34,1.56,0.64,1);
      pointer-events: none;
      white-space: nowrap;
    }
    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       RESPONSIVE â€” small screens
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    @media (max-width: 600px) {
      .side-panel { width: 170px; }
      .header-title { font-size: 14px; }
      .bottom-bar { flex-wrap: wrap; padding: 10px 14px; }
      .speed-group { display: none; }
    }
  </style>
</head>

<body>

<!-- â”€â”€ Top Header â”€â”€ -->
<header class="header">
  <div class="header-left">
    <a class="back-btn" onclick="history.back()" title="Back to Hub">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
        <polyline points="15 18 9 12 15 6"/>
      </svg>
    </a>
    <div class="header-title-group">
      <span class="header-label">3D Avatar Â· ISL</span>
      <span class="header-title">Sign Language Viewer</span>
    </div>
  </div>

  <div class="status-pill">
    <div class="status-dot"></div>
    Avatar Ready
  </div>
</header>

<!-- â”€â”€ Main: Canvas + Side Panel â”€â”€ -->
<div class="main-layout">

  <!-- 3D Canvas -->
  <div class="canvas-wrap" id="canvas-wrap">

    <!-- Loading overlay -->
    <div class="loading-overlay" id="loading-overlay">
      <div class="loader-ring">
        <div class="loader-icon">ğŸ¤Ÿ</div>
      </div>
      <div class="loader-text">Loading Avatarâ€¦</div>
    </div>

    <!-- Active sign label -->
    <div class="sign-label-overlay" id="sign-label">
      <div class="sign-name-chip" id="sign-name-text">HELLO</div>
      <div class="sign-sub-chip">ISL Â· 3D DEMONSTRATION</div>
    </div>

    <!-- Three.js canvas injected here -->
  </div>

  <!-- Side Panel -->
  <aside class="side-panel">
    <div class="panel-header">
      <div class="panel-header-label">Select a Sign</div>
      <div class="panel-header-title">ISL Signs</div>
    </div>

    <!-- Category tabs -->
    <div class="category-tabs">
      <button class="cat-tab active" onclick="setCategory('actions')">Acts</button>
      <!-- <button class="cat-tab" onclick="setCategory('alpha')">Aâ€“Z</button>
      <button class="cat-tab" onclick="setCategory('nums')">0â€“9</button> -->
    </div>

    <!-- Sign buttons list -->
    <div class="sign-list" id="sign-list">
      <!-- Populated by JS -->
    </div>
  </aside>
</div>

<!-- â”€â”€ Bottom Controls Bar â”€â”€ -->
<div class="bottom-bar">

  <!-- Camera controls -->
  <div class="camera-controls">
    <!-- Reset camera -->
    <button class="ctrl-btn" onclick="resetCamera()" title="Reset camera">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
        <path d="M3 3v5h5"/>
      </svg>
    </button>
    <!-- Zoom in -->
    <button class="ctrl-btn" onclick="zoomCamera(-0.4)" title="Zoom in">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
        <circle cx="11" cy="11" r="8"/>
        <line x1="21" y1="21" x2="16.65" y2="16.65"/>
        <line x1="11" y1="8" x2="11" y2="14"/>
        <line x1="8" y1="11" x2="14" y2="11"/>
      </svg>
    </button>
    <!-- Zoom out -->
    <button class="ctrl-btn" onclick="zoomCamera(0.4)" title="Zoom out">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
        <circle cx="11" cy="11" r="8"/>
        <line x1="21" y1="21" x2="16.65" y2="16.65"/>
        <line x1="8" y1="11" x2="14" y2="11"/>
      </svg>
    </button>
  </div>

  <!-- Playback speed -->
  <div class="speed-group">
    <span class="speed-label">Speed</span>
    <div class="speed-pills">
      <button class="speed-pill" onclick="setSpeed(0.5)">0.5Ã—</button>
      <button class="speed-pill active" onclick="setSpeed(1.0)">1Ã—</button>
      <button class="speed-pill" onclick="setSpeed(1.5)">1.5Ã—</button>
      <button class="speed-pill" onclick="setSpeed(2.0)">2Ã—</button>
    </div>
  </div>

  <!-- Loop toggle -->
  <label class="loop-toggle" title="Loop animation">
    <input type="checkbox" id="loop-toggle" checked />
    <div class="toggle-track"><div class="toggle-thumb"></div></div>
    Loop
  </label>
</div>

<!-- Toast notification -->
<div class="toast" id="toast"></div>


<script type="module">
import * as THREE from "three";
import { GLTFLoader } from "three/addons/loaders/GLTFLoader.js";
import { OrbitControls } from "three/addons/controls/OrbitControls.js";

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SIGN DATA â€” grouped by category
// Add more sign names to expand; each name maps to `name.glb`
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SIGNS = {
  actions: [
    { name: "Hello",  emoji: "ğŸ‘‹", sub: "Greeting"      },
    { name: "Push",   emoji: "ğŸ¤œ", sub: "Physical action" },
    { name: "Pull",   emoji: "ğŸ¤›", sub: "Physical action" },
    { name: "Eat",    emoji: "ğŸ½ï¸", sub: "Daily action"   },
    { name: "Drink",  emoji: "ğŸ¥¤", sub: "Daily action"   },
    { name: "Sleep",  emoji: "ğŸ˜´", sub: "Daily action"   },
    { name: "Walk",   emoji: "ğŸš¶", sub: "Movement"       },
    { name: "Stop",   emoji: "âœ‹", sub: "Command"        },
    { name: "Help",   emoji: "ğŸ†˜", sub: "Emergency"      },
    { name: "Thank",  emoji: "ğŸ™", sub: "Greeting"       },
  ],
  // alpha: [
  //   { name: "A", emoji: "ğŸ…°ï¸", sub: "Alphabet" },
  //   { name: "B", emoji: "ğŸ…±ï¸", sub: "Alphabet" },
  //   { name: "C", emoji: "Â©ï¸",  sub: "Alphabet" },
  //   { name: "D", emoji: "D",  sub: "Alphabet" },
  //   { name: "E", emoji: "E",  sub: "Alphabet" },
  //   { name: "F", emoji: "F",  sub: "Alphabet" },
  //   { name: "G", emoji: "G",  sub: "Alphabet" },
  //   { name: "H", emoji: "H",  sub: "Alphabet" },
  //   { name: "I", emoji: "â„¹ï¸", sub: "Alphabet" },
  //   { name: "J", emoji: "J",  sub: "Alphabet" },
  // ],
  // nums: [
  //   { name: "One",   emoji: "1ï¸âƒ£", sub: "Number" },
  //   { name: "Two",   emoji: "2ï¸âƒ£", sub: "Number" },
  //   { name: "Three", emoji: "3ï¸âƒ£", sub: "Number" },
  //   { name: "Four",  emoji: "4ï¸âƒ£", sub: "Number" },
  //   { name: "Five",  emoji: "5ï¸âƒ£", sub: "Number" },
  //   { name: "Six",   emoji: "6ï¸âƒ£", sub: "Number" },
  //   { name: "Seven", emoji: "7ï¸âƒ£", sub: "Number" },
  //   { name: "Eight", emoji: "8ï¸âƒ£", sub: "Number" },
  //   { name: "Nine",  emoji: "9ï¸âƒ£", sub: "Number" },
  //   { name: "Ten",   emoji: "ğŸ”Ÿ", sub: "Number" },
  // ],
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// THREE.JS SETUP
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const canvasWrap = document.getElementById("canvas-wrap");

const scene = new THREE.Scene();
scene.background = new THREE.Color(0x0D0820);

// Subtle fog for depth
scene.fog = new THREE.FogExp2(0x0D0820, 0.045);

const camera = new THREE.PerspectiveCamera(
  45, canvasWrap.clientWidth / canvasWrap.clientHeight, 0.1, 1000
);
camera.position.set(0, 1.4, 3.2);

const renderer = new THREE.WebGLRenderer({
  antialias: true,
  canvas: document.createElement("canvas"),
});
renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
renderer.setSize(canvasWrap.clientWidth, canvasWrap.clientHeight);
renderer.shadowMap.enabled = true;
renderer.shadowMap.type = THREE.PCFSoftShadowMap;
renderer.toneMapping = THREE.ACESFilmicToneMapping;
renderer.toneMappingExposure = 1.2;
renderer.domElement.id = "three-canvas";
canvasWrap.appendChild(renderer.domElement);

// â”€â”€ Lighting â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Key light: warm violet tint from above-left
const keyLight = new THREE.DirectionalLight(0xC8ADFF, 2.2);
keyLight.position.set(-2, 4, 3);
keyLight.castShadow = true;
scene.add(keyLight);

// Fill light: teal accent from right
const fillLight = new THREE.DirectionalLight(0x4DDDC9, 0.8);
fillLight.position.set(3, 1, -2);
scene.add(fillLight);

// Rim light: cool blue from behind
const rimLight = new THREE.DirectionalLight(0x8080FF, 0.5);
rimLight.position.set(0, 2, -4);
scene.add(rimLight);

// Ambient
const ambient = new THREE.HemisphereLight(0x9B72F5, 0x160D2E, 0.7);
scene.add(ambient);

// â”€â”€ Ground plane (reflective) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const groundGeo = new THREE.PlaneGeometry(12, 12);
const groundMat = new THREE.MeshStandardMaterial({
  color: 0x160D2E,
  roughness: 0.8,
  metalness: 0.2,
});
const ground = new THREE.Mesh(groundGeo, groundMat);
ground.rotation.x = -Math.PI / 2;
ground.receiveShadow = true;
scene.add(ground);

// â”€â”€ Grid helper overlay â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const grid = new THREE.GridHelper(10, 20, 0x6C3FF6, 0x6C3FF6);
grid.material.opacity = 0.08;
grid.material.transparent = true;
scene.add(grid);

// â”€â”€ Orbit controls â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const controls = new OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;
controls.dampingFactor = 0.08;
controls.target.set(0, 1.0, 0);
controls.minDistance = 1.5;
controls.maxDistance = 7;
controls.maxPolarAngle = Math.PI / 1.9;
controls.enablePan = false;
controls.update();

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// STATE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const loader = new GLTFLoader();
let mixer = null;
let currentAction = null;
let currentSpeed = 1.0;
let loopEnabled = true;
let currentSignName = null;
const clock = new THREE.Clock();

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PLAY ANIMATION
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function playAnim(signName) {
  if (currentSignName === signName) return; // already playing
  currentSignName = signName;

  // Update UI immediately
  updateSignLabel(signName);
  highlightButton(signName);
  showLoading(true);

  loader.load(
    signName + ".glb",
    (gltf) => {
      // Clear old scene objects except lights & ground
      const toRemove = [];
      scene.traverse((obj) => {
        if (obj.userData.isAvatar) toRemove.push(obj);
      });
      toRemove.forEach((obj) => scene.remove(obj));

      if (mixer) { mixer.stopAllAction(); mixer = null; }

      const model = gltf.scene;
      model.userData.isAvatar = true;

      // Auto-center model
      const box = new THREE.Box3().setFromObject(model);
      const center = box.getCenter(new THREE.Vector3());
      model.position.sub(center);
      model.position.y = 0; // sit on ground

      model.traverse((node) => {
        if (node.isMesh) {
          node.castShadow = true;
          node.receiveShadow = true;
        }
      });

      scene.add(model);

      if (gltf.animations.length > 0) {
        mixer = new THREE.AnimationMixer(model);
        const clip = gltf.animations[0];
        const action = mixer.clipAction(clip);
        action.timeScale = currentSpeed;
        action.setLoop(
          loopEnabled ? THREE.LoopRepeat : THREE.LoopOnce,
          loopEnabled ? Infinity : 1
        );
        action.clampWhenFinished = !loopEnabled;
        action.play();
        currentAction = action;
      }

      showLoading(false);
      showToast(`Playing: ${signName}`);
    },
    undefined,
    (err) => {
      console.warn("GLB load failed:", err);
      showLoading(false);
      // Demo mode: show placeholder avatar shape if .glb not found
      showDemoAvatar(signName);
    }
  );
}

// Demo placeholder when .glb not available yet
function showDemoAvatar(signName) {
  const toRemove = [];
  scene.traverse((obj) => { if (obj.userData.isAvatar) toRemove.push(obj); });
  toRemove.forEach((obj) => scene.remove(obj));

  const group = new THREE.Group();
  group.userData.isAvatar = true;

  // Body
  const bodyGeo = new THREE.CapsuleGeometry ? 
    new THREE.CapsuleGeometry(0.22, 0.7, 8, 16) :
    new THREE.CylinderGeometry(0.22, 0.22, 0.7, 16);
  const bodyMat = new THREE.MeshStandardMaterial({
    color: 0x6C3FF6, roughness: 0.4, metalness: 0.1,
  });
  const body = new THREE.Mesh(bodyGeo, bodyMat);
  body.position.y = 0.9;
  body.castShadow = true;
  group.add(body);

  // Head
  const headGeo = new THREE.SphereGeometry(0.22, 24, 24);
  const headMat = new THREE.MeshStandardMaterial({
    color: 0x9B72F5, roughness: 0.3, metalness: 0.05,
  });
  const head = new THREE.Mesh(headGeo, headMat);
  head.position.y = 1.55;
  head.castShadow = true;
  group.add(head);

  // Accent ring around head
  const ringGeo = new THREE.TorusGeometry(0.26, 0.02, 8, 32);
  const ringMat = new THREE.MeshStandardMaterial({
    color: 0x00C9B1, roughness: 0.2, metalness: 0.5, emissive: 0x00C9B1, emissiveIntensity: 0.3,
  });
  const ring = new THREE.Mesh(ringGeo, ringMat);
  ring.position.y = 1.55;
  ring.rotation.x = Math.PI / 2;
  group.add(ring);

  // Arms
  [-0.35, 0.35].forEach((x, i) => {
    const armGeo = new THREE.CylinderGeometry(0.07, 0.07, 0.55, 10);
    const armMat = new THREE.MeshStandardMaterial({
      color: 0x7C50F7, roughness: 0.5,
    });
    const arm = new THREE.Mesh(armGeo, armMat);
    arm.position.set(x * 1.6, 0.9, 0);
    arm.rotation.z = i === 0 ? 0.5 : -0.5;
    arm.castShadow = true;

    // Animate arm for the demo
    arm.userData.baseRotZ = arm.rotation.z;
    arm.userData.phase = i * Math.PI;
    group.add(arm);
  });

  scene.add(group);

  // Simple oscillate animation
  let t = 0;
  const demoAnimate = () => {
    if (!group.parent) return;
    t += 0.025 * currentSpeed;
    group.children.forEach((child) => {
      if (child.userData.baseRotZ !== undefined) {
        child.rotation.z =
          child.userData.baseRotZ + Math.sin(t + child.userData.phase) * 0.25;
      }
    });
    requestAnimationFrame(demoAnimate);
  };
  demoAnimate();

  showToast(`Demo: ${signName} (connect .glb to activate)`);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// CONTROLS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.setSpeed = (s) => {
  currentSpeed = s;
  if (currentAction) currentAction.timeScale = s;
  document.querySelectorAll(".speed-pill").forEach((el) => {
    el.classList.toggle("active", parseFloat(el.textContent) === s);
  });
};

window.resetCamera = () => {
  camera.position.set(0, 1.4, 3.2);
  controls.target.set(0, 1.0, 0);
  controls.update();
};

window.zoomCamera = (delta) => {
  const dir = new THREE.Vector3();
  camera.getWorldDirection(dir);
  camera.position.addScaledVector(dir, -delta);
};

window.setCategory = (cat) => {
  document.querySelectorAll(".cat-tab").forEach((el) => {
    el.classList.toggle("active", el.getAttribute("onclick").includes(cat));
  });
  buildSignList(cat);
};

document.getElementById("loop-toggle").addEventListener("change", (e) => {
  loopEnabled = e.target.checked;
  if (currentAction) {
    currentAction.setLoop(
      loopEnabled ? THREE.LoopRepeat : THREE.LoopOnce,
      loopEnabled ? Infinity : 1
    );
  }
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// UI HELPERS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateSignLabel(name) {
  const overlay = document.getElementById("sign-label");
  const nameEl  = document.getElementById("sign-name-text");
  nameEl.textContent = name.toUpperCase();
  overlay.classList.add("visible");
}

function highlightButton(name) {
  document.querySelectorAll(".sign-btn").forEach((btn) => {
    btn.classList.toggle("playing", btn.dataset.name === name);
    const playEl = btn.querySelector(".sign-btn-play");
    if (playEl) {
      playEl.innerHTML =
        btn.dataset.name === name
          ? `<div class="play-bars">
               <div class="play-bar"></div>
               <div class="play-bar"></div>
               <div class="play-bar"></div>
             </div>`
          : `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
               <polygon points="5 3 19 12 5 21 5 3" fill="currentColor" stroke="none"/>
             </svg>`;
    }
  });
}

function showLoading(show) {
  const el = document.getElementById("loading-overlay");
  el.classList.toggle("hidden", !show);
}

let toastTimer;
function showToast(msg) {
  const toast = document.getElementById("toast");
  toast.textContent = msg;
  toast.classList.add("show");
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => toast.classList.remove("show"), 2200);
}

function buildSignList(category) {
  const list = document.getElementById("sign-list");
  list.innerHTML = "";
  (SIGNS[category] || []).forEach((sign) => {
    const btn = document.createElement("button");
    btn.className = "sign-btn";
    btn.dataset.name = sign.name;
    if (sign.name === currentSignName) btn.classList.add("playing");

    const isPlaying = sign.name === currentSignName;
    btn.innerHTML = `
      <div class="sign-btn-icon" style="background:rgba(108,63,246,0.12)">
        ${sign.emoji}
      </div>
      <div class="sign-btn-text">
        <span class="sign-btn-name">${sign.name}</span>
        <span class="sign-btn-sub">${sign.sub}</span>
      </div>
      <div class="sign-btn-play">
        ${isPlaying
          ? `<div class="play-bars">
               <div class="play-bar"></div>
               <div class="play-bar"></div>
               <div class="play-bar"></div>
             </div>`
          : `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
               <polygon points="5 3 19 12 5 21 5 3" fill="currentColor" stroke="none"/>
             </svg>`
        }
      </div>`;
    btn.addEventListener("click", () => playAnim(sign.name));
    list.appendChild(btn);
  });
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// RESIZE HANDLER
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.addEventListener("resize", () => {
  const w = canvasWrap.clientWidth;
  const h = canvasWrap.clientHeight;
  camera.aspect = w / h;
  camera.updateProjectionMatrix();
  renderer.setSize(w, h);
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// RENDER LOOP
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function animate() {
  requestAnimationFrame(animate);
  const delta = clock.getDelta();
  if (mixer) mixer.update(delta * currentSpeed);
  controls.update();
  renderer.render(scene, camera);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// INIT
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// Hide loading â€” initial state (no GLB loaded yet)
showLoading(false);

// Build initial sign list
buildSignList("actions");

// Auto-play first sign (Hello) in demo mode
setTimeout(() => playAnim("Hello"), 400);

// Expose for HTML buttons (backward compat)
window.playAnim = playAnim;

// Start render loop
animate();

</script>
</body>
</html>

<!-- <!DOCTYPE html>
<html>
<head>
  <title>ISL Avatar MVP</title>
  <style>
    body { margin: 0; overflow: hidden; background: #f5f5f5; }
    button {
      position: absolute;
      bottom: 20px;
      padding: 10px 15px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>

  <script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
      "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
    }
  }
  </script>
</head>

<body>

<button onclick="playAnim('Hello')" style="left:20px;">Hello</button>
<button onclick="playAnim('Push')" style="left:110px;">Push</button>
<button onclick="playAnim('Pull')" style="left:240px;">Pull</button>

<script type="module">

import * as THREE from "three";
import { GLTFLoader } from "three/addons/loaders/GLTFLoader.js";

let scene = new THREE.Scene();
let camera = new THREE.PerspectiveCamera(
  45,
  window.innerWidth / window.innerHeight,
  0.1,
  1000
);
camera.position.set(0, 1.5, 3);

let renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

let light = new THREE.HemisphereLight(0xffffff, 0x444444);
scene.add(light);

let mixer;
let avatar;
let loader = new GLTFLoader();



window.playAnim = function(name) {

  loader.load(name + ".glb", function(gltf) {

    while(scene.children.length > 0){ 
      scene.remove(scene.children[0]); 
    }

    let light = new THREE.HemisphereLight(0xffffff, 0x444444);
    scene.add(light);

    let model = gltf.scene;
    scene.add(model);

    mixer = new THREE.AnimationMixer(model);
    let clip = gltf.animations[0];
    let action = mixer.clipAction(clip);
    action.play();

  });

};


function animate() {
  requestAnimationFrame(animate);
  if (mixer) mixer.update(0.016);
  renderer.render(scene, camera);
}

animate();

</script>

</body>
</html> -->
