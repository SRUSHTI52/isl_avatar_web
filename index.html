<!DOCTYPE html>
<html>
<head>
  <title>ISL Avatar MVP</title>
  <style>
    body { margin: 0; overflow: hidden; background: #f5f5f5; }
    button {
      position: absolute;
      bottom: 20px;
      padding: 10px 15px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>

  <!-- ðŸ”¥ IMPORT MAP FIX -->
  <script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
      "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
    }
  }
  </script>
</head>

<body>

<button onclick="playAnim('Hello')" style="left:20px;">Hello</button>
<button onclick="playAnim('Push')" style="left:110px;">Push</button>
<button onclick="playAnim('Pull')" style="left:240px;">Pull</button>

<script type="module">

import * as THREE from "three";
import { GLTFLoader } from "three/addons/loaders/GLTFLoader.js";

let scene = new THREE.Scene();
let camera = new THREE.PerspectiveCamera(
  45,
  window.innerWidth / window.innerHeight,
  0.1,
  1000
);
camera.position.set(0, 1.5, 3);

let renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

let light = new THREE.HemisphereLight(0xffffff, 0x444444);
scene.add(light);

let mixer;
let avatar;
let loader = new GLTFLoader();

// Load Avatar
// loader.load(
//   "https://models.readyplayer.me/699328e105b43df7aa816091.glb",
//   function (gltf) {
//     avatar = gltf.scene;
//     scene.add(avatar);
//     mixer = new THREE.AnimationMixer(avatar);
//   },
//   undefined,
//   function (error) {
//     console.error("Avatar load error:", error);
//   }
// );

// Global animation trigger
window.playAnim = function(name) {

  loader.load(name + ".glb", function(gltf) {

    // Remove previous model
    while(scene.children.length > 0){ 
      scene.remove(scene.children[0]); 
    }

    // Add light again
    let light = new THREE.HemisphereLight(0xffffff, 0x444444);
    scene.add(light);

    let model = gltf.scene;
    scene.add(model);

    mixer = new THREE.AnimationMixer(model);
    let clip = gltf.animations[0];
    let action = mixer.clipAction(clip);
    action.play();

  });

};


function animate() {
  requestAnimationFrame(animate);
  if (mixer) mixer.update(0.016);
  renderer.render(scene, camera);
}

animate();

</script>

</body>
</html>
